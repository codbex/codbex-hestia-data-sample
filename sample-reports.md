Sample Reports in SQL format

## Finance

### Unpaid Sales Orders

- Basic query

```sql
SELECT *
FROM CODBEX_SALESORDER as SO
JOIN
    CODBEX_SALESORDERSTATUS S ON SO.SALESORDER_SALESORDERSTATUS = S.SALESORDERSTATUS_ID
WHERE 
    S.SALESORDERSTATUS_NAME != 'Paid'
```

- Count all sales orders and group by `CUSTOMER` and order by `number of unpaid orders`

```sql
SELECT
    C.CUSTOMER_NAME,
    COUNT(SO.SALESORDER_ID) AS UNPAID_SALES_ORDERS,
    SUM(SO.SALESORDER_TOTAL) AS UNPAID_AMOUNT
FROM 
    CODBEX_CUSTOMER C
JOIN 
    CODBEX_SALESORDER SO ON C.CUSTOMER_ID = SO.SALESORDER_CUSTOMER
JOIN 
    CODBEX_SALESORDERSTATUS S ON SO.SALESORDER_SALESORDERSTATUS = S.SALESORDERSTATUS_ID
WHERE 
    S.SALESORDERSTATUS_NAME != 'Paid'
GROUP BY 
    C.CUSTOMER_ID, C.CUSTOMER_NAME
ORDER BY 
    UNPAID_SALES_ORDERS DESC;
```

- Count sales orders and group by `CUSTOMER` and order by `number of unpaid amount`

```sql
SELECT
    C.CUSTOMER_NAME,
    COUNT(SO.SALESORDER_ID) AS UNPAID_SALES_ORDERS,
    SUM(SO.SALESORDER_TOTAL) AS UNPAID_AMOUNT
FROM 
    CODBEX_CUSTOMER C
JOIN 
    CODBEX_SALESORDER SO ON C.CUSTOMER_ID = SO.SALESORDER_CUSTOMER
JOIN 
    CODBEX_SALESORDERSTATUS S ON SO.SALESORDER_SALESORDERSTATUS = S.SALESORDERSTATUS_ID
WHERE 
    S.SALESORDERSTATUS_NAME != 'Paid'
GROUP BY 
    C.CUSTOMER_ID, C.CUSTOMER_NAME
ORDER BY 
    UNPAID_AMOUNT DESC;
```

- All unpaid sales orders group by `CUSTOMER`, `SALESORDER_NUMBER` and order by `SALESORDER_DUE` ASC 

```sql
SELECT
    SO.SALESORDER_NUMBER,
    C.CUSTOMER_NAME,
    SO.SALESORDER_DATE,
    SO.SALESORDER_DUE,
    SUM(SO.SALESORDER_TOTAL) AS UNPAID_AMOUNT
FROM 
    CODBEX_CUSTOMER C
JOIN 
    CODBEX_SALESORDER SO ON C.CUSTOMER_ID = SO.SALESORDER_CUSTOMER
JOIN 
    CODBEX_SALESORDERSTATUS S ON SO.SALESORDER_SALESORDERSTATUS = S.SALESORDERSTATUS_ID
WHERE 
    S.SALESORDERSTATUS_NAME != 'Paid'
GROUP BY 
    C.CUSTOMER_NAME, SO.SALESORDER_NUMBER
ORDER BY SO.SALESORDER_DUE ASC
```

### Cashflow

- Net Cashflow
```sql
SELECT 
    SUM(TRANSACTION_AMOUNT) AS CASHFLOW_NET,
    DATE_TRUNC('day', TRANSACTION_DATE) AS CASHFLOW_DATE
FROM (
    SELECT 
        SALESINVOICE_DATE AS TRANSACTION_DATE,
        SALESINVOICE_NET AS TRANSACTION_AMOUNT
    FROM CODBEX_SALESINVOICE
    UNION ALL
    SELECT 
        PURCHASEINVOICE_DATE AS TRANSACTION_DATE,
        -PURCHASEINVOICE_NET AS TRANSACTION_AMOUNT
    FROM CODBEX_PURCHASEINVOICE
) AS CombinedData
GROUP BY DATE_TRUNC('day', TRANSACTION_DATE)
ORDER BY CASHFLOW_DATE DESC;
```

- VAT each month(sum(sales_invoices.vat) - sum(purchase_invoices.vat))

```sql
SELECT 
    SUM(VAT) AS CASHFLOW_VAT,
    DATE_TRUNC('month', TRANSACTION_DATE) AS CASHFLOW_DATE
FROM (
    SELECT 
        SALESINVOICE_DATE AS TRANSACTION_DATE,
        SALESINVOICE_VAT AS VAT
    FROM CODBEX_SALESINVOICE
    UNION ALL
    SELECT 
        PURCHASEINVOICE_DATE AS TRANSACTION_DATE,
        -PURCHASEINVOICE_VAT AS VAT
    FROM CODBEX_PURCHASEINVOICE
) AS CombinedData
GROUP BY DATE_TRUNC('month', TRANSACTION_DATE)
ORDER BY CASHFLOW_DATE DESC;
```